import{f as b,a as S,s as x}from"./main-tHCI4F-E.js";import"./vendor-2fZl6onH.js";let d=null;async function E(){if(d)return d;const t=await b();return d={},t.genres&&Array.isArray(t.genres)&&t.genres.forEach(e=>{d[e.id]=e.name}),d}function w(){const t=localStorage.getItem("library");return t?JSON.parse(t):[]}function C(t){localStorage.setItem("library",JSON.stringify(t))}function k(t,e){let n=w();const o=t.id;n.includes(o)?(n=n.filter(i=>i!==o),e.textContent="Add to library",e.classList.remove("removed")):(n.push(o),e.textContent="Remove from my library",e.classList.add("removed")),C(n)}function q(t,e){w().includes(t.id)?(e.textContent="Remove from my library",e.classList.add("removed")):(e.textContent="Add to library",e.classList.remove("removed"))}async function _(t){if(!t||typeof t!="object"){console.error("createMoviePopup: Geçersiz movie parametresi!",t);return}let e=document.querySelector("#popup-template");if(!e){let i=window.location.hostname==="localhost"?"/popup.html":`/${window.location.pathname.split("/")[1]}/popup.html`;try{const r=await fetch(i);if(!r.ok)throw console.error(`Popup.html yüklenemedi. Durum: ${r.status}, URL: ${r.url}`),new Error("Network response was not ok.");const y=await r.text(),m=document.createElement("div");m.innerHTML=y;const s=m.querySelector(".movie-popup-overlay");s?(s.id="popup-template",document.body.appendChild(s),await h(s,t)):console.error("movie-popup-overlay bulunamadı, HTML içeriği eksik olabilir.")}catch(r){console.error("Popup yüklenirken bir hata oluştu:",r)}return}const n=e.cloneNode(!0);n.id="",await h(n,t)}async function h(t,e){if(!e||typeof e!="object"){console.error("Geçersiz movie verisi:",e);return}t.style.display="flex";const n=t.querySelector(".movie-popup-img");n.src=e.poster_path?`https://image.tmdb.org/t/p/original${e.poster_path}`:"",n.alt=e.title||"No title",t.querySelector(".movie-popup-title").textContent=e.title||"Untitled",t.querySelector(".vote-avg").textContent=e.vote_average!=null?e.vote_average.toFixed(1):"-",t.querySelector(".vote-count").textContent=e.vote_count!=null?e.vote_count:"-",t.querySelector(".popularity-value").textContent=e.popularity!=null?e.popularity.toFixed(1):"-";let o="-";if(e.genre_names&&Array.isArray(e.genre_names))o=e.genre_names.join(", ");else if(e.genre_ids&&Array.isArray(e.genre_ids)){const f=await E();o=e.genre_ids.map(g=>f[g]||g).join(", ")}t.querySelector(".genre-value").textContent=o,t.querySelector(".about-value").textContent=e.overview||"No description.";const i=t.querySelector(".movie-popup-add-btn");i&&(q(e,i),i.addEventListener("click",function(){k(e,this)}));const r=t.querySelector(".movie-popup-close"),y=window.location.hostname==="localhost",m=y?"":window.location.pathname.split("/")[1],s=y?"":`/${m}`;r.addEventListener("mouseenter",()=>{r.querySelector("img").src=`${s}/img/svg/close-hover.svg`}),r.addEventListener("mouseleave",()=>{r.querySelector("img").src=`${s}/img/svg/close.svg`}),r.addEventListener("click",()=>t.remove()),t.addEventListener("mousedown",function(f){f.target===t&&t.remove()}),document.body.appendChild(t)}let l,p,a,u,c;function M(){p.addEventListener("click",t=>{const e=t.target.closest("li.movie-item");!e||!e._movieData||_(e._movieData)})}function L(t){if(p.innerHTML="",!t||t.length===0){a.style.display="block";return}a.style.display="none",t.filter(e=>e&&e.poster_path).forEach(e=>{const n=document.createElement("li");n.classList.add("movie-item"),n.innerHTML=`
        <img src="https://image.tmdb.org/t/p/w500${e.poster_path}" alt="${e.title}" />
        <div class="movie-item-text">
          <h3>${e.title}</h3>
          <p>${e.release_date?.split("-")[0]||"Unknown"}</p>
        </div>`,n._movieData=e,p.appendChild(n)})}function $(){const t=new Date().getFullYear();for(let e=t;e>=1900;e--){const n=document.createElement("option");n.value=e,n.textContent=e,u.appendChild(n)}}async function v(){try{const t=await S();L(t.results)}catch{a.textContent="Failed to load movies.",a.style.display="block"}}async function B(t,e=""){try{const n=await x(t,e);L(n.results)}catch{a.textContent="Search failed.",a.style.display="block"}}async function I(){if(l=document.getElementById("search-form"),p=document.getElementById("movie-list"),a=document.getElementById("no-results"),u=document.getElementById("year-select"),c=document.getElementById("clear-search"),!l||!p||!a||!u||!c){console.error("Catalog init error: Missing DOM elements");return}$(),await v(),M(),l.addEventListener("submit",async t=>{t.preventDefault();const e=l.query.value.trim(),n=u.value;e&&await B(e,n)}),l.query.addEventListener("input",()=>{c.style.display=l.query.value?"block":"none"}),c.addEventListener("click",()=>{l.query.value="",u.value="",c.style.display="none",v()}),c.style.display="none"}export{I as initCatalog};
//# sourceMappingURL=catalog-9JliTZs2.js.map
