{"version":3,"file":"catalog-CE3CXGLu.js","sources":["../../src/js/popup.js","../../src/js/catalog.js"],"sourcesContent":["import {\n  fetchPopularMovies,\n  fetchDailyTrending,\n  fetchWeeklyTrending,\n  fetchUpcomingMovies,\n  searchMovies,\n  fetchGenres,\n  fetchMovieDetails,\n  fetchMovieVideos,\n} from '../api/tmdbApi.js';\n\nlet genreMap = null;\n\nasync function ensureGenreMap() {\n  if (genreMap) return genreMap;\n  const data = await fetchGenres();\n  genreMap = {};\n  if (data.genres && Array.isArray(data.genres)) {\n    data.genres.forEach(g => {\n      genreMap[g.id] = g.name;\n    });\n  }\n  return genreMap;\n}\n\nfunction getLibrary() {\n  const data = localStorage.getItem('library');\n  return data ? JSON.parse(data) : [];\n}\n\nfunction saveLibrary(library) {\n  localStorage.setItem('library', JSON.stringify(library));\n}\n\nfunction toggleLibrary(movie, button) {\n  let library = getLibrary();\n  const movieId = movie.id;\n\n  if (library.includes(movieId)) {\n    library = library.filter(id => id !== movieId);\n    button.textContent = 'Add to library';\n    button.classList.remove('removed');\n  } else {\n    library.push(movieId);\n    button.textContent = 'Remove from my library';\n    button.classList.add('removed');\n  }\n\n  saveLibrary(library);\n}\n\nfunction updateButtonState(movie, button) {\n  const library = getLibrary();\n  if (library.includes(movie.id)) {\n    button.textContent = 'Remove from my library';\n    button.classList.add('removed');\n  } else {\n    button.textContent = 'Add to library';\n    button.classList.remove('removed');\n  }\n}\n\nexport async function createMoviePopup(movie) {\n  if (!movie || typeof movie !== 'object') {\n    console.error('createMoviePopup: Geçersiz movie parametresi!', movie);\n    return;\n  }\n\n  let template = document.querySelector('#popup-template');\n  if (!template) {\n    const isLocal = window.location.hostname === 'localhost';\n    let popupPath = isLocal\n      ? '/popup.html'\n      : `/${window.location.pathname.split('/')[1]}/popup.html`;\n\n    try {\n      const res = await fetch(popupPath);\n      if (!res.ok) {\n        console.error(\n          `Popup.html yüklenemedi. Durum: ${res.status}, URL: ${res.url}`\n        );\n        throw new Error('Network response was not ok.');\n      }\n      const html = await res.text();\n      const tempDiv = document.createElement('div');\n      tempDiv.innerHTML = html;\n      const popupOverlay = tempDiv.querySelector('.movie-popup-overlay');\n      if (popupOverlay) {\n        popupOverlay.id = 'popup-template';\n        document.body.appendChild(popupOverlay);\n        await showPopupFromTemplate(popupOverlay, movie);\n      } else {\n        console.error(\n          'movie-popup-overlay bulunamadı, HTML içeriği eksik olabilir.'\n        );\n      }\n    } catch (error) {\n      console.error('Popup yüklenirken bir hata oluştu:', error);\n    }\n    return;\n  }\n\n  const popupOverlay = template.cloneNode(true);\n  popupOverlay.id = '';\n  await showPopupFromTemplate(popupOverlay, movie);\n}\n\nasync function showPopupFromTemplate(popupOverlay, movie) {\n  if (!movie || typeof movie !== 'object') {\n    console.error('Geçersiz movie verisi:', movie);\n    return;\n  }\n\n  popupOverlay.style.display = 'flex';\n\n  // Görsel\n  const img = popupOverlay.querySelector('.movie-popup-img');\n  img.src = movie.poster_path\n    ? `https://image.tmdb.org/t/p/original${movie.poster_path}`\n    : '';\n  img.alt = movie.title || 'No title';\n\n  // Başlık\n  popupOverlay.querySelector('.movie-popup-title').textContent =\n    movie.title || 'Untitled';\n\n  // Vote/votes\n  popupOverlay.querySelector('.vote-avg').textContent =\n    movie.vote_average != null ? movie.vote_average.toFixed(1) : '-';\n  popupOverlay.querySelector('.vote-count').textContent =\n    movie.vote_count != null ? movie.vote_count : '-';\n\n  // Popularity\n  popupOverlay.querySelector('.popularity-value').textContent =\n    movie.popularity != null ? movie.popularity.toFixed(1) : '-';\n\n  // Genre\n  let genreText = '-';\n  if (movie.genre_names && Array.isArray(movie.genre_names)) {\n    genreText = movie.genre_names.join(', ');\n  } else if (movie.genre_ids && Array.isArray(movie.genre_ids)) {\n    const map = await ensureGenreMap();\n    genreText = movie.genre_ids.map(id => map[id] || id).join(', ');\n  }\n  popupOverlay.querySelector('.genre-value').textContent = genreText;\n\n  // About\n  popupOverlay.querySelector('.about-value').textContent =\n    movie.overview || 'No description.';\n\n  // Library butonu\n  const addBtn = popupOverlay.querySelector('.movie-popup-add-btn');\n  if (addBtn) {\n    updateButtonState(movie, addBtn);\n    addBtn.addEventListener('click', function () {\n      toggleLibrary(movie, this);\n    });\n  }\n\n  // Kapatma butonu ve ikon davranışları\n  const closeBtn = popupOverlay.querySelector('.movie-popup-close');\n  const isLocal = window.location.hostname === 'localhost';\n  const repoName = isLocal ? '' : window.location.pathname.split('/')[1];\n  const basePath = isLocal ? '' : `/${repoName}`;\n\n  closeBtn.addEventListener('mouseenter', () => {\n    closeBtn.querySelector('img').src = `${basePath}/img/svg/close-hover.svg`;\n  });\n\n  closeBtn.addEventListener('mouseleave', () => {\n    closeBtn.querySelector('img').src = `${basePath}/img/svg/close.svg`;\n  });\n\n  closeBtn.addEventListener('click', () => popupOverlay.remove());\n\n  popupOverlay.addEventListener('mousedown', function (e) {\n    if (e.target === popupOverlay) {\n      popupOverlay.remove();\n    }\n  });\n\n  // Ekrana ekle\n  document.body.appendChild(popupOverlay);\n}\n","import { fetchWeeklyTrending, searchMovies } from '../api/tmdbApi.js';\nimport { createMoviePopup } from './popup.js';\n\nlet form, movieList, noResults, yearSelect, clearBtn;\nlet currentPage = 1;\nlet currentQuery = '';\nlet currentYear = '';\n\nfunction enableMoviePopups() {\n  movieList.addEventListener('click', e => {\n    const li = e.target.closest('li.movie-item');\n    if (!li || !li._movieData) return;\n    createMoviePopup(li._movieData);\n  });\n}\n\nfunction renderMovies(movies) {\n  movieList.innerHTML = '';\n\n  if (!movies || movies.length === 0) {\n    noResults.style.display = 'block';\n    return;\n  }\n\n  noResults.style.display = 'none';\n\n  movies\n    .filter(m => m && m.poster_path)\n    .forEach(movie => {\n      const li = document.createElement('li');\n      li.classList.add('movie-item');\n      li.innerHTML = `\n        <img src=\"https://image.tmdb.org/t/p/w500${movie.poster_path}\" alt=\"${\n        movie.title\n      }\" />\n        <div class=\"movie-item-text\">\n          <h3>${movie.title}</h3>\n          <p>${movie.release_date?.split('-')[0] || 'Unknown'}</p>\n        </div>`;\n      li._movieData = movie;\n      movieList.appendChild(li);\n    });\n}\n\nfunction populateYearSelect() {\n  const now = new Date().getFullYear();\n  for (let y = now; y >= 1900; y--) {\n    const option = document.createElement('option');\n    option.value = y;\n    option.textContent = y;\n    yearSelect.appendChild(option);\n  }\n}\n\nasync function loadTrending() {\n  try {\n    const data = await fetchWeeklyTrending();\n    renderMovies(data.results);\n  } catch (err) {\n    noResults.textContent = 'Failed to load movies.';\n    noResults.style.display = 'block';\n  }\n}\n\nasync function performSearch(query, year = '') {\n  try {\n    const data = await searchMovies(query, year);\n    renderMovies(data.results);\n  } catch (err) {\n    noResults.textContent = 'Search failed.';\n    noResults.style.display = 'block';\n  }\n}\n\nexport async function initCatalog() {\n  form = document.getElementById('search-form');\n  movieList = document.getElementById('movie-list');\n  noResults = document.getElementById('no-results');\n  yearSelect = document.getElementById('year-select');\n  clearBtn = document.getElementById('clear-search');\n\n  if (!form || !movieList || !noResults || !yearSelect || !clearBtn) {\n    console.error('Catalog init error: Missing DOM elements');\n    return;\n  }\n\n  populateYearSelect();\n  await loadTrending();\n  enableMoviePopups();\n\n  // Submit (search) action\n  form.addEventListener('submit', async e => {\n    e.preventDefault();\n    const query = form.query.value.trim();\n    const year = yearSelect.value;\n    currentQuery = query;\n    currentYear = year;\n    if (query) {\n      await performSearch(query, year);\n    }\n  });\n\n  // Show/hide clear button on input\n  form.query.addEventListener('input', () => {\n    clearBtn.style.display = form.query.value ? 'block' : 'none';\n  });\n\n  // Clear button resets form and loads trending again\n  clearBtn.addEventListener('click', () => {\n    form.query.value = '';\n    yearSelect.value = '';\n    clearBtn.style.display = 'none';\n    loadTrending();\n  });\n\n  // Başlangıçta clear butonunu gizle\n  clearBtn.style.display = 'none';\n}\n"],"names":["genreMap","ensureGenreMap","data","fetchGenres","g","getLibrary","saveLibrary","library","toggleLibrary","movie","button","movieId","id","updateButtonState","createMoviePopup","template","popupPath","res","html","tempDiv","popupOverlay","showPopupFromTemplate","error","img","genreText","map","addBtn","closeBtn","isLocal","repoName","basePath","e","form","movieList","noResults","yearSelect","clearBtn","enableMoviePopups","li","renderMovies","movies","m","populateYearSelect","now","y","option","loadTrending","fetchWeeklyTrending","performSearch","query","year","searchMovies","initCatalog"],"mappings":"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"}