import{f as P,a as $,b as I}from"./assets/scroll-up-C8J8yvIH.js";import"./assets/main-DWsmwN1R.js";async function H(){const e=document.querySelector(".library-hero-bg");if(e)try{const r=(await P())?.results;if(!r||r.length===0)return;const n=r[Math.floor(Math.random()*r.length)]?.backdrop_path;if(n){const a=`https://image.tmdb.org/t/p/w1920${n}`;e.style.backgroundImage=`url('${a}')`,e.style.backgroundSize="cover",e.style.backgroundPosition="center"}}catch(t){console.error("Hero görseli yüklenemedi:",t)}}H();async function D(e,t){let r=document.querySelector("#popup-template");if(!r){const n=window.location.hostname==="localhost",a=n?"":window.location.pathname.split("/")[1],l=n?"./partials/library-popup.html":`/${a}/library-popup.html`;try{const s=await fetch(l);if(!s.ok){console.error(`Popup.html yüklenemedi. Durum: ${s.status}, URL: ${s.url}`);return}const g=await s.text(),p=document.createElement("div");p.innerHTML=g;const i=p.querySelector(".movie-popup-overlay");if(!i){console.error("movie-popup-overlay bulunamadı.");return}i.id="popup-template",document.body.appendChild(i),await x(i,e,t)}catch(s){console.error("Popup yüklenirken bir hata oluştu:",s)}return}const o=r.cloneNode(!0);o.id="",await x(o,e,t)}async function x(e,t,r){e.style.display="flex";const o=e.querySelector(".movie-popup-img");o.src=t.poster_path?`https://image.tmdb.org/t/p/original${t.poster_path}`:"",o.alt=t.title,e.querySelector(".movie-popup-title").textContent=t.title,e.querySelector(".vote-avg").textContent=t.vote_average?.toFixed(1)??"-",e.querySelector(".vote-count").textContent=t.vote_count??"-",e.querySelector(".popularity-value").textContent=t.popularity?.toFixed(1)??"-";let n="-";t.genre_names?.length?n=t.genre_names.join(", "):t.genres?.length?n=t.genres.map(i=>i.name).join(", "):t.genre_ids?.length&&(n=t.genre_ids.map(i=>r[i]||i).join(", ")),e.querySelector(".genre-value").textContent=n,e.querySelector(".about-value").textContent=t.overview||"No description.";const a=e.querySelector(".movie-popup-add-btn.removed");a&&(a.style.display="inline-block",a.onclick=()=>{let i=JSON.parse(localStorage.getItem("library"))||[];i=i.filter(B=>B!==t.id),localStorage.setItem("library",JSON.stringify(i)),S(),window.location.reload()});const l=e.querySelector(".movie-popup-close"),s=window.location.hostname==="localhost",g=s?"":window.location.pathname.split("/")[1],p=s?"":`/${g}`;l.addEventListener("mouseenter",()=>{l.querySelector("img").src=`${p}/img/svg/close-hover.svg`}),l.addEventListener("mouseleave",()=>{l.querySelector("img").src=`${p}/img/svg/close.svg`}),l.addEventListener("click",()=>S()),e.addEventListener("mousedown",i=>{i.target===e&&S()}),document.body.appendChild(e)}function S(){const e=document.querySelector(".movie-popup-overlay")||document.querySelector("#popup-template");e&&e.remove()}const h=document.getElementById("library-film-list"),y=document.getElementById("library-placeholder"),q=document.querySelector(".library-custom-select"),f=document.querySelector(".library-selected-option"),c=document.querySelector(".library-genre-options"),L=document.getElementById("load-more-btn"),b=document.getElementById("library-loading");let u=null,d=[],m=0;const G=9;function _(){q.style.visibility="visible"}function C(){q.style.visibility="hidden"}async function F(){if(u)return u;const e=await I();return u={},e.genres&&Array.isArray(e.genres)&&e.genres.forEach(t=>{u[t.id]=t.name}),u}async function j(){T(),C(),c.classList.add("hidden");const e=JSON.parse(localStorage.getItem("library"))||[];if(e.length===0){y.style.display="flex",h.innerHTML="",v();return}y.style.display="none",h.innerHTML="",u=await F(),d=[];const t=new Set;for(const r of e)try{const o=await $(r);d.push(o),o.genres?.length?o.genres.forEach(n=>t.add(n.id)):o.genre_ids?.length&&o.genre_ids.forEach(n=>t.add(n))}catch(o){console.error(`Film ${r} getirilemedi`,o)}await N([...t],""),m=0,E(),k(),_(),v()}async function N(e,t=""){try{const o=(await I()).genres;if(c.innerHTML="",t){const n=document.createElement("li");n.textContent="Genre",n.dataset.id="",n.addEventListener("click",()=>{f.childNodes[0].nodeValue="Genre",c.classList.add("hidden"),M("")}),c.appendChild(n)}o.forEach(n=>{if(e.includes(n.id)&&n.id!==Number(t)){const a=document.createElement("li");a.textContent=n.name,a.dataset.id=n.id,a.addEventListener("click",()=>{f.childNodes[0].nodeValue=n.name,c.classList.add("hidden"),M(n.id)}),c.appendChild(a)}})}catch(r){console.error("Kategoriler alınamadı:",r)}}async function M(e){T(),C(),c.classList.add("hidden");const t=JSON.parse(localStorage.getItem("library"))||[];if(t.length===0){y.style.display="flex",h.innerHTML="",v();return}y.style.display="none",h.innerHTML="",d=[];const r=Number(e);for(const n of t)try{const a=await $(n),l=a.genres?.map(s=>s.id)||a.genre_ids||[];(!e||l.includes(r))&&d.push(a)}catch(a){console.error(`Film ${n} getirilemedi`,a)}m=0,E(),k(),d.length===0&&(y.style.display="flex");const o=new Set;d.forEach(n=>{n.genres?.length?n.genres.forEach(a=>o.add(a.id)):n.genre_ids?.length&&n.genre_ids.forEach(a=>o.add(a))}),await N([...o],r),_(),v()}function E(){const e=m+G;d.slice(m,e).forEach(r=>{const o=J(r,u);h.appendChild(o)}),m=e}function k(){L&&(L.style.display=m>=d.length?"none":"block")}function J(e,t){const r=document.createElement("li");r.classList.add("library-item");const o=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",n=e.release_date?.split("-")[0]||"Bilinmiyor",a=e.vote_average||0,l=e.genres?.map(g=>g.name).join(", ")||"Tür bilinmiyor",s=A(a);return r.innerHTML=`
    <img src="${o}" alt="${e.title}" class="library-film-poster" />
    <div class="library-overlay">
      <h3 class="library-film-title">${e.title}</h3>
      <div class="library-bottom-row">
        <p class="library-film-info">${l} | ${n}</p>
        <div class="library-stars">${s}</div>
      </div>
    </div>
  `,r.addEventListener("click",()=>{D(e,t)}),r}const w={full:"./img/svg/star.svg",half:"./img/svg/star-half.svg",empty:"./img/svg/star-outline.svg"};function A(e){const t=Math.floor(e/2),r=e%2>=1?1:0,o=5-t-r;return`<img class="star-icon full" src="${w.full}" alt="star" />`.repeat(t)+`<img class="star-icon half" src="${w.half}" alt="half star" />`.repeat(r)+`<img class="star-icon empty" src="${w.empty}" alt="empty star" />`.repeat(o)}function T(){b&&(b.style.display="block")}function v(){b&&(b.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{f.childNodes[0].nodeValue="Genre",j();const e=document.getElementById("go-to-catalog");e&&e.addEventListener("click",()=>{window.location.href="catalog.html"}),f.addEventListener("click",()=>{c.classList.toggle("hidden")}),Q,L.addEventListener("click",()=>{E(),k()}),document.addEventListener("click",t=>{t.target.closest(".library-custom-select")||c.classList.add("hidden")})});
//# sourceMappingURL=mylibrary.js.map
